<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ - ‡πÅ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .cursor-none { cursor: none; }
        .text-shadow-lg { text-shadow: 0 4px 12px rgba(0,0,0,0.8); }
        .glass-effect { background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .progress-bar-fill { transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.4s ease-in-out; }
    </style>
</head>
<body class="bg-slate-950 text-white min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Firebase Modules ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, addDoc, updateDoc, deleteDoc, serverTimestamp, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-storage.js";

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDadMZYr6lioUdc894l7PZzt6dxs8Ep_gw",
            authDomain: "test-318d9.firebaseapp.com",
            projectId: "test-318d9",
            storageBucket: "test-318d9.firebasestorage.app",
            messagingSenderId: "313725009474",
            appId: "1:313725009474:web:42d018f2b4a4ae2c1977db",
            measurementId: "G-0J344393JS"
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'photo-queue-v1';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const SETTINGS_COLLECTION = ['artifacts', appId, 'public', 'data', 'settings'];
        const QUEUE_COLLECTION = ['artifacts', appId, 'public', 'data', 'queue'];

        // --- SVG Icons ---
        const Icons = {
            Monitor: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
            Settings: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            User: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
            Upload: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>,
            Trash: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            Check: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            Image: () => <svg className="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            Link: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>
        };

        // --- View: Customer ---
        const CustomerView = ({ config, user }) => {
            const [formData, setFormData] = useState({ name: '', message: '' });
            const [selectedFile, setSelectedFile] = useState(null);
            const [previewUrl, setPreviewUrl] = useState('');
            const [status, setStatus] = useState(null);
            const [errorMessage, setErrorMessage] = useState('');
            const [uploadProgress, setUploadProgress] = useState(0);
            const [uploading, setUploading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!selectedFile || !user) return;
                
                setUploading(true);
                setUploadProgress(0);
                setStatus(null);
                setErrorMessage('');

                try {
                    const fileName = `${Date.now()}_${selectedFile.name.replace(/\s+/g, '_')}`;
                    const storagePath = `artifacts/${appId}/public/uploads/${fileName}`;
                    const storageRef = ref(storage, storagePath);
                    
                    // Add metadata to help Firebase
                    const metadata = {
                        contentType: selectedFile.type
                    };

                    const uploadTask = uploadBytesResumable(storageRef, selectedFile, metadata);

                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            setUploadProgress(Math.floor(progress));
                        }, 
                        (error) => {
                            console.error("Firebase Upload Error Detail:", error);
                            let msg = "‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á";
                            if (error.code === 'storage/unauthorized') {
                                msg = "‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Rules ‡πÉ‡∏ô Storage Dashboard)";
                            } else if (error.code === 'storage/canceled') {
                                msg = "‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
                            }
                            setErrorMessage(msg);
                            setStatus('error');
                            setUploading(false);
                        }, 
                        async () => {
                            try {
                                const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                                
                                await addDoc(collection(db, ...QUEUE_COLLECTION), {
                                    name: formData.name || '‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô',
                                    message: formData.message || '',
                                    imageUrl: downloadURL,
                                    status: 'pending',
                                    createdAt: serverTimestamp(),
                                    userId: user.uid
                                });

                                setStatus('success');
                                setFormData({ name: '', message: '' });
                                setSelectedFile(null);
                                setPreviewUrl('');
                                setUploading(false);
                                setTimeout(() => setStatus(null), 5000);
                            } catch (dbErr) {
                                console.error("Database Error:", dbErr);
                                setErrorMessage("‡∏£‡∏π‡∏õ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                                setStatus('error');
                                setUploading(false);
                            }
                        }
                    );

                } catch (err) {
                    console.error("Initialization Error:", err);
                    setErrorMessage("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ");
                    setStatus('error');
                    setUploading(false);
                }
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 10 * 1024 * 1024) {
                        alert("‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 10MB)");
                        return;
                    }
                    setSelectedFile(file);
                    const reader = new FileReader();
                    reader.onloadend = () => setPreviewUrl(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="max-w-md mx-auto p-6 pt-12">
                    <div className="text-center mb-10">
                        <div className="inline-block p-4 rounded-3xl bg-blue-600/20 mb-4 border border-blue-500/20 shadow-xl">
                            <Icons.Image />
                        </div>
                        <h1 className="text-4xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500 mb-2">{config.title}</h1>
                        <p className="opacity-50">‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB)</p>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-6">
                        <div className="relative group">
                            <div className={`w-full h-72 border-2 border-dashed rounded-3xl flex flex-col items-center justify-center overflow-hidden transition-all duration-300 ${previewUrl ? 'border-blue-500 bg-blue-500/5 shadow-2xl scale-105' : 'border-white/10 bg-white/5 hover:border-white/30'}`}>
                                {previewUrl ? (
                                    <div className="relative w-full h-full">
                                        <img src={previewUrl} className="w-full h-full object-cover" alt="Preview" />
                                        {uploading && (
                                            <div className="absolute inset-0 bg-black/80 backdrop-blur-md flex flex-col items-center justify-center p-6 transition-all duration-500">
                                                <div className="w-full max-w-[200px] bg-white/10 h-4 rounded-full overflow-hidden mb-4 border border-white/20">
                                                    <div 
                                                        className="progress-bar-fill bg-gradient-to-r from-blue-500 to-cyan-400 h-full shadow-[0_0_10px_rgba(59,130,246,0.5)]" 
                                                        style={{ width: `${uploadProgress}%` }}
                                                    ></div>
                                                </div>
                                                <div className="text-5xl font-black text-white mb-2">{uploadProgress}%</div>
                                                <p className="text-sm text-blue-300 font-bold animate-pulse tracking-widest uppercase">Uploading...</p>
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="text-center p-8 space-y-4">
                                        <div className="text-blue-400/50 mx-auto flex justify-center"><Icons.Upload /></div>
                                        <p className="text-sm opacity-40 font-bold uppercase tracking-widest">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                                        <p className="text-[10px] opacity-20 uppercase tracking-tighter">Support up to 10MB</p>
                                    </div>
                                )}
                                <input disabled={uploading} type="file" accept="image/*" onChange={handleFileChange} className="absolute inset-0 opacity-0 cursor-pointer" />
                            </div>
                            {previewUrl && !uploading && (
                                <button type="button" onClick={() => {setPreviewUrl(''); setSelectedFile(null);}} className="absolute top-4 right-4 bg-red-500 p-2 rounded-full shadow-2xl hover:scale-110 transition">
                                    <Icons.X />
                                </button>
                            )}
                        </div>

                        <div className="space-y-4">
                            <input disabled={uploading} required type="text" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} className="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-4 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all disabled:opacity-50" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." />
                            <textarea disabled={uploading} value={formData.message} onChange={e => setFormData({...formData, message: e.target.value})} className="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-4 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all disabled:opacity-50" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏≤‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏á‡∏≤‡∏ô..." rows="3" />
                        </div>

                        <button disabled={uploading || !selectedFile} className={`w-full py-5 rounded-3xl font-black text-xl flex items-center justify-center gap-3 shadow-2xl transition-all active:scale-95 ${uploading || !selectedFile ? 'bg-slate-800 text-white/30' : 'bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 shadow-blue-500/20'}`}>
                            {uploading ? `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á... ${uploadProgress}%` : <><Icons.Upload /> ‡∏™‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</>}
                        </button>

                        {status === 'success' && (
                            <div className="bg-green-500/10 border border-green-500/30 text-green-400 p-5 rounded-2xl text-center animate-in fade-in zoom-in duration-300 shadow-xl shadow-green-500/10">
                                <p className="font-bold text-xl mb-1">‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! üöÄ</p>
                                <p className="text-xs opacity-70">‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>
                            </div>
                        )}
                        {status === 'error' && (
                            <div className="bg-red-500/10 border border-red-500/30 text-red-400 p-5 rounded-2xl text-center animate-shake shadow-xl shadow-red-500/10">
                                <p className="font-bold text-xl mb-1">‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‚ùå</p>
                                <p className="text-xs opacity-80">{errorMessage}</p>
                            </div>
                        )}
                        
                        {/* Quick Troubleshooting Tip */}
                        <div className="mt-8 p-4 bg-white/5 rounded-2xl border border-white/10 text-[10px] opacity-30 leading-relaxed">
                            <p className="font-bold uppercase mb-1">Troubleshooting:</p>
                            <p>‡∏ñ‡πâ‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà 0-1% ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Firebase Storage Rules ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Public (allow read, write: if true;) ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS ‡πÉ‡∏ô Google Cloud Console ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á</p>
                        </div>
                    </form>
                </div>
            );
        };

        // --- View: Admin ---
        const AdminView = ({ config, queue }) => {
            const [activeTab, setActiveTab] = useState('queue');
            const [copyStatus, setCopyStatus] = useState(null);

            const updateConfig = (key, value) => { setDoc(doc(db, ...SETTINGS_COLLECTION, 'main'), { ...config, [key]: value }); };
            const updateStatus = (id, status) => { updateDoc(doc(db, ...QUEUE_COLLECTION, id), { status }); };
            const deleteItem = (id) => { deleteDoc(doc(db, ...QUEUE_COLLECTION, id)); };

            const clearAllData = async () => {
                if (window.confirm("‚ùó ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Ñ‡∏¥‡∏ß (‡∏£‡∏ß‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û) ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                    const snapshot = await getDocs(collection(db, ...QUEUE_COLLECTION));
                    snapshot.forEach((d) => deleteDoc(d.ref));
                }
            };

            const pending = queue.filter(i => i.status === 'pending');
            const approved = useMemo(() => {
                const list = queue.filter(i => i.status === 'approved');
                if (list.length === 0) return [];
                const currentIndex = config.currentIndex || 0;
                const safeIndex = currentIndex % list.length;
                const activeItem = list[safeIndex];
                const others = list.filter(item => item.id !== activeItem?.id);
                return activeItem ? [activeItem, ...others] : list;
            }, [queue, config.currentIndex]);

            const copyLink = (param) => {
                const url = window.location.origin + window.location.pathname + (param ? `?view=${param}` : '');
                const dummy = document.createElement("input");
                document.body.appendChild(dummy);
                dummy.value = url;
                dummy.select();
                document.execCommand("copy");
                document.body.removeChild(dummy);
                setCopyStatus(param || 'customer');
                setTimeout(() => setCopyStatus(null), 2000);
            };

            return (
                <div className="max-w-6xl mx-auto p-6 pb-40">
                    <header className="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
                        <div>
                            <h1 className="text-3xl font-black text-white flex items-center gap-3">
                                <div className="p-2 bg-purple-600 rounded-xl shadow-lg shadow-purple-600/20"><Icons.Settings /></div>
                                ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                            </h1>
                            <p className="opacity-40 text-sm mt-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö Real-time</p>
                        </div>
                        <div className="flex gap-4">
                            <button onClick={clearAllData} className="px-5 py-3 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-500 text-sm font-bold hover:bg-red-500 hover:text-white transition-all flex items-center gap-2">
                                <Icons.Trash /> ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </header>

                    <div className="flex gap-4 mb-8 bg-white/5 p-1.5 rounded-2xl inline-flex shadow-inner">
                        <button onClick={() => setActiveTab('queue')} className={`px-8 py-3 rounded-xl transition-all font-bold text-sm ${activeTab === 'queue' ? 'bg-white/10 shadow-lg text-white' : 'opacity-40 hover:opacity-100'}`}>
                            ‡∏Ñ‡∏¥‡∏ß‡∏†‡∏≤‡∏û ({pending.length})
                        </button>
                        <button onClick={() => setActiveTab('settings')} className={`px-8 py-3 rounded-xl transition-all font-bold text-sm ${activeTab === 'settings' ? 'bg-white/10 shadow-lg text-white' : 'opacity-40 hover:opacity-100'}`}>
                            ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>

                    {activeTab === 'queue' ? (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                            <section className="space-y-6">
                                <div className="flex items-center gap-3 border-b border-white/5 pb-4">
                                    <div className="w-2.5 h-2.5 rounded-full bg-yellow-500 animate-pulse"></div>
                                    <h2 className="text-xl font-bold uppercase tracking-wider">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    {pending.map(item => (
                                        <div key={item.id} className="bg-white/5 border border-white/10 rounded-3xl overflow-hidden group shadow-xl transition-transform hover:-translate-y-1">
                                            <div className="h-48 relative">
                                                <img src={item.imageUrl} className="w-full h-full object-cover" alt="" />
                                                <div className="absolute inset-0 bg-black/70 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center gap-4">
                                                    <button onClick={() => updateStatus(item.id, 'approved')} className="p-4 bg-green-500 rounded-2xl shadow-xl hover:scale-110 active:scale-95 transition"><Icons.Check /></button>
                                                    <button onClick={() => deleteItem(item.id)} className="p-4 bg-red-500 rounded-2xl shadow-xl hover:scale-110 active:scale-95 transition"><Icons.Trash /></button>
                                                </div>
                                            </div>
                                            <div className="p-4 bg-white/[0.02]">
                                                <p className="font-bold text-sm truncate">{item.name}</p>
                                                <p className="text-xs opacity-40 line-clamp-1 mt-1 italic">"{item.message || '...'}"</p>
                                            </div>
                                        </div>
                                    ))}
                                    {pending.length === 0 && <div className="col-span-full py-20 text-center opacity-20 italic bg-white/5 rounded-[2rem] border-2 border-dashed border-white/10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>}
                                </div>
                            </section>

                            <section className="space-y-6">
                                <div className="flex items-center gap-3 border-b border-white/5 pb-4">
                                    <div className="w-2.5 h-2.5 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"></div>
                                    <h2 className="text-xl font-bold uppercase tracking-wider">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (‡∏Ñ‡∏¥‡∏ß‡∏£‡∏±‡∏ô‡∏†‡∏≤‡∏û)</h2>
                                </div>
                                <div className="space-y-3 max-h-[600px] overflow-y-auto pr-3 custom-scrollbar">
                                    {approved.map((item, idx) => (
                                        <div key={item.id} className={`flex items-center gap-5 p-5 rounded-[2rem] border transition-all duration-500 ${idx === 0 ? 'bg-blue-600/20 border-blue-500/50 shadow-2xl shadow-blue-500/10 scale-[1.02]' : 'bg-white/5 border-white/10 hover:bg-white/10'}`}>
                                            <div className="relative flex-shrink-0">
                                                <img src={item.imageUrl} className="w-24 h-24 rounded-2xl object-cover shadow-2xl border border-white/10" />
                                                {idx === 0 && <div className="absolute -top-3 -left-3 bg-blue-500 text-[10px] font-black px-2 py-1 rounded-lg animate-bounce shadow-lg">SHOWING</div>}
                                            </div>
                                            <div className="flex-1 min-w-0">
                                                <p className="font-bold text-xl truncate mb-1">{item.name}</p>
                                                <p className="text-sm opacity-50 truncate italic font-light">"{item.message || '...'}"</p>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => updateStatus(item.id, 'pending')} title="‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" className="p-3 text-yellow-500 hover:bg-yellow-500/10 rounded-2xl transition"><Icons.X /></button>
                                                <button onClick={() => deleteItem(item.id)} title="‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£" className="p-3 text-red-500 hover:bg-red-500/10 rounded-2xl transition"><Icons.Trash /></button>
                                            </div>
                                        </div>
                                    ))}
                                    {approved.length === 0 && <div className="py-20 text-center opacity-20 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</div>}
                                </div>
                            </section>
                        </div>
                    ) : (
                        <div className="bg-white/5 border border-white/10 rounded-[3rem] p-12 max-w-2xl mx-auto space-y-12 shadow-2xl">
                            <div className="space-y-8">
                                <h3 className="text-2xl font-black text-blue-400 tracking-tight">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</h3>
                                <div>
                                    <label className="block text-xs opacity-40 mb-3 font-bold uppercase tracking-widest">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (Title)</label>
                                    <input type="text" value={config.title} onChange={e => updateConfig('title', e.target.value)} className="w-full bg-black/40 border border-white/10 rounded-[1.5rem] px-6 py-4 focus:ring-2 focus:ring-blue-500 outline-none transition-all shadow-inner" />
                                </div>
                            </div>
                            <div className="space-y-8 pt-12 border-t border-white/10">
                                <h3 className="text-2xl font-black text-blue-400 tracking-tight">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-10">
                                    <div>
                                        <label className="block text-xs opacity-40 mb-3 font-bold uppercase tracking-widest">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡πÑ‡∏•‡∏î‡πå (ms)</label>
                                        <input type="number" step="500" value={config.transitionSpeed} onChange={e => updateConfig('transitionSpeed', parseInt(e.target.value) || 5000)} className="w-full bg-black/40 border border-white/10 rounded-[1.5rem] px-6 py-4 outline-none shadow-inner" />
                                    </div>
                                    <div className="flex items-center gap-5 bg-black/30 p-6 rounded-[1.5rem] border border-white/5 shadow-inner">
                                        <input type="checkbox" checked={config.autoPlay} onChange={e => updateConfig('autoPlay', e.target.checked)} className="w-7 h-7 accent-blue-500 cursor-pointer rounded-lg" id="autoplay-check" />
                                        <label htmlFor="autoplay-check" className="font-bold cursor-pointer text-lg">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Quick Link Switcher */}
                    <div className="fixed bottom-8 left-1/2 -translate-x-1/2 glass-effect px-6 py-4 rounded-full border border-white/20 flex gap-6 shadow-[0_20px_50px_rgba(0,0,0,0.5)] z-50">
                        <button onClick={() => copyLink('')} className="flex items-center gap-3 px-2 py-1 hover:text-blue-400 transition text-[10px] font-black uppercase tracking-widest group">
                            <Icons.Link /> <span className="group-hover:underline">{copyStatus === 'customer' ? 'COPIED!' : 'Customer Page'}</span>
                        </button>
                        <div className="w-px bg-white/10 h-6 my-auto"></div>
                        <button onClick={() => copyLink('display')} className="flex items-center gap-3 px-2 py-1 hover:text-green-400 transition text-[10px] font-black uppercase tracking-widest group">
                            <Icons.Link /> <span className="group-hover:underline">{copyStatus === 'display' ? 'COPIED!' : 'Display Screen'}</span>
                        </button>
                        <div className="w-px bg-white/10 h-6 my-auto"></div>
                        <button onClick={() => copyLink('admin')} className="flex items-center gap-3 px-2 py-1 hover:text-purple-400 transition text-[10px] font-black uppercase tracking-widest group">
                            <Icons.Link /> <span className="group-hover:underline">{copyStatus === 'admin' ? 'COPIED!' : 'Admin Panel'}</span>
                        </button>
                    </div>
                </div>
            );
        };

        // --- View: Display ---
        const DisplayView = ({ config, queue, setView }) => {
            const [localIndex, setLocalIndex] = useState(0);
            const [isTransitioning, setIsTransitioning] = useState(false);
            const approvedItems = queue.filter(i => i.status === 'approved');

            useEffect(() => {
                if (config.autoPlay && approvedItems.length > 1) {
                    const t = setInterval(() => {
                        handleNext();
                    }, config.transitionSpeed);
                    return () => clearInterval(t);
                }
            }, [config.autoPlay, config.transitionSpeed, approvedItems.length]);

            const handleNext = async () => {
                setIsTransitioning(true);
                setTimeout(async () => {
                    const nextIndex = (localIndex + 1) % approvedItems.length;
                    setLocalIndex(nextIndex);
                    setIsTransitioning(false);
                    // Share current index to Cloud to let Admin know what is playing
                    try {
                        await updateDoc(doc(db, ...SETTINGS_COLLECTION, 'main'), { currentIndex: nextIndex });
                    } catch(e) {}
                }, 800);
            };

            if (approvedItems.length === 0) return (
                <div className="h-screen flex flex-col items-center justify-center text-center p-12 bg-slate-950">
                    <h1 className="text-8xl font-black mb-12 animate-pulse bg-clip-text text-transparent bg-gradient-to-br from-blue-400 via-indigo-500 to-purple-600 drop-shadow-2xl">{config.title}</h1>
                    <div className="bg-white/5 p-20 rounded-[5rem] border border-white/10 backdrop-blur-[100px] shadow-[0_0_100px_rgba(59,130,246,0.1)]">
                        <div className="text-blue-500/20 flex justify-center mb-8 scale-[2]"><Icons.Image /></div>
                        <p className="text-4xl font-light opacity-30 tracking-tight">Waiting for someone to share a photo...</p>
                    </div>
                </div>
            );

            const safeIdx = localIndex >= approvedItems.length ? 0 : localIndex;
            const item = approvedItems[safeIdx];

            return (
                <div className="h-screen w-screen bg-black flex flex-col relative overflow-hidden cursor-none" onDoubleClick={() => setView('admin')}>
                    {/* Background Dynamic Ambience */}
                    <div className="absolute inset-0 blur-[180px] opacity-30 scale-150 transition-all duration-1500" style={{backgroundImage: `url(${item.imageUrl})`, backgroundSize: 'cover', backgroundPosition: 'center'}}></div>
                    
                    {/* Header */}
                    <div className="absolute top-0 w-full p-16 flex justify-between items-start z-20">
                        <div className="space-y-3">
                            <h2 className="text-7xl font-black italic tracking-tighter text-shadow-lg text-white/95 leading-tight">{config.title}</h2>
                            <div className="flex items-center gap-4">
                                <div className="w-3.5 h-3.5 rounded-full bg-red-600 animate-pulse shadow-[0_0_15px_rgba(220,38,38,0.8)]"></div>
                                <p className="text-blue-400 font-black tracking-[0.5em] uppercase text-2xl opacity-90 drop-shadow-lg">LIVE PHOTO FEED</p>
                            </div>
                        </div>
                        <div className="text-6xl font-mono font-thin text-white/40 tracking-tighter drop-shadow-2xl">
                            <LiveTime />
                        </div>
                    </div>

                    {/* Image Area */}
                    <div className={`flex-1 flex items-center justify-center p-24 z-10 transition-all duration-1000 transform ${isTransitioning ? 'opacity-0 scale-90 blur-3xl rotate-1' : 'opacity-100 scale-100 blur-0 rotate-0'}`}>
                        <div className="relative">
                            <div className="absolute -inset-20 bg-blue-500/5 blur-[120px] rounded-full animate-pulse"></div>
                            <img src={item.imageUrl} className="max-w-full max-h-[72vh] object-contain rounded-[3rem] shadow-[0_50px_120px_-30px_rgba(0,0,0,1)] border-[6px] border-white/5" />
                        </div>
                    </div>

                    {/* Bottom Info Bar */}
                    <div className={`glass-effect w-full p-14 md:p-20 z-20 flex items-center gap-16 transition-all duration-1000 transform ${isTransitioning ? 'translate-y-60 opacity-0' : 'translate-y-0 opacity-100'}`}>
                        <div className="w-32 h-32 rounded-[2.5rem] bg-gradient-to-br from-blue-600 to-indigo-800 flex items-center justify-center text-6xl font-black shadow-[0_20px_50px_rgba(37,99,235,0.4)] flex-shrink-0 text-white transform rotate-3 hover:rotate-0 transition-transform">
                            {item.name ? item.name[0].toUpperCase() : '?'}
                        </div>
                        <div className="flex-1 space-y-4">
                            <div className="flex items-center gap-8">
                                <h3 className="text-8xl font-black text-white text-shadow-lg tracking-tight leading-none">{item.name}</h3>
                            </div>
                            <p className="text-5xl text-white/70 italic font-extralight tracking-tight line-clamp-1 leading-normal pr-10">
                                {item.message ? `"${item.message}"` : "Sharing memories with you"}
                            </p>
                        </div>
                        <div className="hidden 2xl:flex border-l border-white/10 pl-20 items-center gap-10">
                            <div className="text-right space-y-2">
                                <p className="text-sm uppercase tracking-[0.6em] opacity-30 font-black">Join the Feed</p>
                                <p className="text-2xl font-black text-blue-400 drop-shadow-lg">Scan to Share</p>
                            </div>
                            <div className="w-28 h-28 bg-white rounded-[2rem] p-2 flex items-center justify-center shadow-[0_25px_50px_rgba(0,0,0,0.5)] transform -rotate-2 hover:rotate-0 transition-all">
                                <div className="text-black text-xs font-black text-center leading-none">SCAN<br/><span className="text-[30px] leading-none">üì∏</span><br/>HERE</div>
                            </div>
                        </div>
                    </div>

                    {/* Progress Loader */}
                    <div className="absolute bottom-0 left-0 h-2.5 bg-gradient-to-r from-blue-600 via-indigo-500 to-purple-600 z-30 shadow-[0_-5px_15px_rgba(59,130,246,0.3)]" style={{
                        width: '100%', 
                        transform: `scaleX(${isTransitioning ? 0 : 1})`, 
                        transformOrigin: 'left', 
                        transition: isTransitioning ? 'none' : `transform ${config.transitionSpeed}ms linear`
                    }}></div>
                </div>
            );
        };

        const App = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const viewParam = urlParams.get('view') || 'customer';
            
            const [user, setUser] = useState(null);
            const [config, setConfig] = useState({ title: "MEMORIES LIVE", transitionSpeed: 5000, autoPlay: true, theme: 'dark', currentIndex: 0 });
            const [queue, setQueue] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            try { await signInWithCustomToken(auth, __initial_auth_token); } 
                            catch (e) { await signInAnonymously(auth); }
                        } else { await signInAnonymously(auth); }
                    } catch (e) { console.error(e); }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (u) => { setUser(u); setLoading(false); });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const unsubConfig = onSnapshot(doc(db, ...SETTINGS_COLLECTION, 'main'), (s) => {
                    if (s.exists()) setConfig(s.data());
                    else setDoc(doc(db, ...SETTINGS_COLLECTION, 'main'), config);
                });
                const unsubQueue = onSnapshot(collection(db, ...QUEUE_COLLECTION), (s) => {
                    setQueue(s.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)));
                });
                return () => { unsubConfig(); unsubQueue(); };
            }, [user]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-950">
                    <div className="w-20 h-20 border-[6px] border-blue-600 border-t-transparent rounded-full animate-spin mb-8 shadow-[0_0_40px_rgba(59,130,246,0.2)]"></div>
                    <p className="text-blue-500 font-black tracking-[0.5em] text-sm animate-pulse">CONNECTING TO STREAM...</p>
                </div>
            );

            return (
                <div className="min-h-screen selection:bg-blue-600 selection:text-white">
                    {viewParam === 'admin' && <AdminView config={config} queue={queue} />}
                    {viewParam === 'display' && <DisplayView config={config} queue={queue} setView={setUser} />}
                    {viewParam === 'customer' && <CustomerView config={config} user={user} />}
                </div>
            );
        };

        const LiveTime = () => {
            const [time, setTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);
            return time.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
